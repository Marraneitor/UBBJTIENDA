<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UBBJ Tienda â€” Panel del Vendedor</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#C9A84C">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="https://firebasestorage.googleapis.com/v0/b/ubbjtienda.firebasestorage.app/o/Logoubbj.png?alt=media">

  <!-- Estilos -->
  <link rel="stylesheet" href="style.css">
</head>

<body data-page="perfilvendedor">

  <!-- Spinner de carga -->
  <div id="spinner-overlay" class="spinner-overlay">
    <div class="spinner"></div>
  </div>

  <!-- ===== LOGIN OVERLAY ===== -->
  <div id="vendor-login-overlay" class="login-overlay">
    <div class="login-box" style="position:relative">
      <a href="index.html" class="buyer-close-btn" title="Cerrar">âœ•</a>
      <h2>ğŸ”‘ Panel del Vendedor</h2>
      <p>Ingresa tu nÃºmero de WhatsApp y la contraseÃ±a que creaste al registrarte.</p>
      <div class="form-group" style="margin-bottom:0.75rem">
        <label for="vendor-phone" style="font-weight:600;font-size:0.85rem;margin-bottom:0.25rem;display:block">NÃºmero de WhatsApp</label>
        <input type="tel" id="vendor-phone" placeholder="Ej: 5212345678">
      </div>
      <div class="form-group" style="margin-bottom:0.75rem">
        <label for="vendor-pass" style="font-weight:600;font-size:0.85rem;margin-bottom:0.25rem;display:block">ContraseÃ±a</label>
        <input type="password" id="vendor-pass" placeholder="ContraseÃ±a">
      </div>
      <button id="vendor-login-btn" class="btn btn-primary" style="width:100%">Entrar</button>
      <p style="margin-top:1rem;font-size:0.82rem;color:var(--text-secondary);text-align:center">
        Este panel es para vendedores registrados.<br>
        Â¿Deseas vender? <a href="vender.html" style="color:var(--accent);font-weight:700;text-decoration:underline">RegÃ­strate aquÃ­</a>
      </p>
    </div>
  </div>

  <!-- ===== NAVBAR ===== -->
  <nav class="navbar">
    <div class="container">
      <a href="index.html" class="logo">
        <img src="Logoubbj.png" alt="UBBJ"> UBBJ Tienda
      </a>
      <button id="menu-toggle" class="menu-toggle" aria-label="MenÃº">â˜°</button>
      <ul id="nav-links" class="nav-links">
        <li><a href="index.html">CatÃ¡logo</a></li>
        <li><a href="vender.html">Vender</a></li>
        <li><a href="perfilvendedor.html" class="active">Mi Panel (Vendedores)</a></li>
        <li><a href="ubbjotito.html">Mi Ubbjotito</a></li>
      </ul>
    </div>
  </nav>

  <!-- ===== PROFILE HEADER ===== -->
  <header class="profile-header">
    <div class="avatar-edit-wrapper">
      <img id="vp-avatar" class="profile-avatar" src="https://placehold.co/110/e2e8f0/64748b?text=ğŸ‘¤" alt="Avatar">
      <label for="vp-photo-input" class="avatar-edit-btn" title="Cambiar foto">ğŸ“·</label>
      <input type="file" id="vp-photo-input" accept="image/*" style="display:none">
    </div>
    <h1 id="vp-name" class="profile-name">Cargando...</h1>
    <p id="vp-career" class="profile-career"></p>

    <!-- DescripciÃ³n editable -->
    <div class="vendor-bio-section">
      <textarea id="vp-bio" class="vendor-bio-input" placeholder="Describe quÃ© tipo de cosas vendes... Ej: Comida casera, libros usados, electrÃ³nica" maxlength="200"></textarea>
      <button id="vp-save-bio" class="btn btn-primary btn-sm">ğŸ’¾ Guardar descripciÃ³n</button>
    </div>

    <button id="vp-logout-btn" class="btn btn-outline-sm" style="margin-top:0.75rem">ğŸšª Cerrar sesiÃ³n</button>
  </header>

  <!-- ===== SUB-MENÃš DE PESTAÃ‘AS ===== -->
  <div class="panel-tabs-wrapper">
    <nav class="panel-tabs">
      <button class="panel-tab active" data-tab="tab-productos">ğŸ“¦ Productos</button>
      <button class="panel-tab" data-tab="tab-pedidos">
        ğŸ“‹ Pedidos <span id="tab-pedidos-badge" class="tab-badge" style="display:none">0</span>
      </button>
      <button class="panel-tab" data-tab="tab-estadisticas">ğŸ“Š EstadÃ­sticas</button>
      <button class="panel-tab" data-tab="tab-config">âš™ï¸ Ajustes</button>
    </nav>
  </div>

  <!-- ========================================= -->
  <!-- TAB: PRODUCTOS                            -->
  <!-- ========================================= -->
  <div id="tab-productos" class="panel-tab-content active">

    <!-- AÃ±adir producto -->
    <div class="container">
      <div class="add-product-section">
        <button id="toggle-add-product" class="btn btn-primary add-product-toggle">â• AÃ±adir Producto</button>

        <div id="add-product-form" class="add-product-form">
          <h3>Nuevo producto</h3>
          <form id="product-form" autocomplete="off">
            <div class="form-group">
              <label for="nombre">Nombre del artÃ­culo *</label>
              <input type="text" id="nombre" name="nombre" placeholder="Ej: Calculadora cientÃ­fica" required>
            </div>
            <div class="form-group">
              <label for="precio">Precio (MXN) *</label>
              <input type="number" id="precio" name="precio" min="1" step="0.01" placeholder="150.00" required>
            </div>
            <div class="form-group">
              <label for="prod-categoria">CategorÃ­a del producto *</label>
              <select id="prod-categoria" name="prod-categoria" required>
                <option value="">Selecciona una categorÃ­a...</option>
                <option value="ğŸ” Comida">ğŸ” Comida</option>
                <option value="ğŸ¥¤ Bebidas">ğŸ¥¤ Bebidas</option>
                <option value="ğŸ° Postres">ğŸ° Postres</option>
                <option value="ğŸ¬ Snacks">ğŸ¬ Snacks</option>
                <option value="ğŸ“š Materiales">ğŸ“š Materiales</option>
                <option value="ğŸ‘• Ropa">ğŸ‘• Ropa</option>
                <option value="ğŸ’» TecnologÃ­a">ğŸ’» TecnologÃ­a</option>
                <option value="âœï¸ Servicios">âœï¸ Servicios</option>
                <option value="ğŸ¨ Otros">ğŸ¨ Otros</option>
              </select>
            </div>
            <div class="form-group">
              <label for="descripcion">DescripciÃ³n (opcional)</label>
              <textarea id="descripcion" name="descripcion" placeholder="CondiciÃ³n, detalles, accesorios..."></textarea>
            </div>
            <div class="form-group">
              <label for="lugar">Lugar de entrega *</label>
              <input type="text" id="lugar" name="lugar" placeholder="Ej: CafeterÃ­a, Edificio B" required>
            </div>
            <div class="form-group">
              <label>Foto del producto</label>
              <div class="file-input-wrapper">
                <input type="file" id="product-image" accept="image/*">
                <div class="upload-text">
                  <div class="upload-icon">ğŸ“·</div>
                  <strong>Haz clic</strong> o arrastra una imagen aquÃ­
                </div>
              </div>
              <img id="product-img-preview" class="img-preview" alt="Vista previa">
            </div>
            <button type="submit" class="btn btn-primary form-submit">ğŸš€ Publicar producto</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Mis productos -->
    <main class="container">
      <h2 style="font-size:1.15rem;font-weight:700;margin-bottom:1rem;">ğŸ“¦ Mis Productos</h2>
      <div id="my-product-grid" class="product-grid">
        <!-- Se generan dinÃ¡micamente -->
      </div>
    </main>

  </div><!-- /tab-productos -->

  <!-- ========================================= -->
  <!-- TAB: PEDIDOS                              -->
  <!-- ========================================= -->
  <div id="tab-pedidos" class="panel-tab-content">

    <div class="container">
      <div class="vendor-orders-section">
        <h3>ğŸ“‹ Pedidos pendientes <span id="orders-pending-badge" class="unread-badge" style="display:none">0</span></h3>
        <div id="vendor-orders-list" class="vendor-orders-list">
          <p class="empty-orders-msg">No tienes pedidos pendientes ğŸ‰</p>
        </div>
      </div>

      <!-- Historial de pedidos (entregados/cancelados) -->
      <div class="vendor-orders-section" style="margin-top:1.5rem;">
        <button id="toggle-history-btn" class="order-history-toggle">
          ğŸ“ Historial de pedidos <span id="history-count-badge" class="history-count">0</span>
          <span id="history-arrow" class="history-arrow">â–¼</span>
        </button>
        <div id="vendor-orders-history" class="vendor-orders-list" style="display:none;margin-top:0.75rem;">
          <p class="empty-orders-msg">No hay pedidos en el historial</p>
        </div>
      </div>
    </div>

  </div><!-- /tab-pedidos -->

  <!-- ========================================= -->
  <!-- TAB: ESTADÃSTICAS                         -->
  <!-- ========================================= -->
  <div id="tab-estadisticas" class="panel-tab-content">

    <div class="container">
      <div class="vendor-stats-section">
        <h3>ğŸ“Š Mis EstadÃ­sticas</h3>
        <div class="stats-cards-row">
          <div class="stat-mini-card">
            <span class="stat-mini-icon">ğŸ‘ï¸</span>
            <span class="stat-mini-value" id="stat-visits">0</span>
            <span class="stat-mini-label">Visitas</span>
          </div>
          <div class="stat-mini-card">
            <span class="stat-mini-icon">ğŸ›’</span>
            <span class="stat-mini-value" id="stat-orders">0</span>
            <span class="stat-mini-label">Pedidos</span>
          </div>
          <div class="stat-mini-card">
            <span class="stat-mini-icon">â­</span>
            <span class="stat-mini-value" id="stat-rating">0</span>
            <span class="stat-mini-label">CalificaciÃ³n</span>
          </div>
          <div class="stat-mini-card">
            <span class="stat-mini-icon">ğŸ’°</span>
            <span class="stat-mini-value" id="stat-revenue">$0</span>
            <span class="stat-mini-label">Ingresos</span>
          </div>
        </div>
        <div class="stats-chart-container">
          <h4 style="font-size:0.85rem;font-weight:600;margin-bottom:0.5rem;">ğŸ“ˆ Visitas Ãºltimos 7 dÃ­as</h4>
          <canvas id="visits-chart" height="180"></canvas>
        </div>
        <div class="stats-chart-container" style="margin-top:1rem;">
          <h4 style="font-size:0.85rem;font-weight:600;margin-bottom:0.5rem;">â­ Calificaciones recibidas</h4>
          <canvas id="ratings-chart" height="180"></canvas>
        </div>
      </div>
    </div>

  </div><!-- /tab-estadisticas -->

  <!-- ========================================= -->
  <!-- TAB: CONFIGURACIÃ“N                        -->
  <!-- ========================================= -->
  <div id="tab-config" class="panel-tab-content">

    <!-- ConfiguraciÃ³n del perfil -->
    <div class="container">
      <div class="vendor-config-section">
        <h3>âš™ï¸ ConfiguraciÃ³n de mi perfil</h3>

        <div class="config-row">
          <div class="config-info">
            <span class="config-label">â—† Fuera de servicio</span>
            <span class="config-hint">Tu perfil aparecerÃ¡ como "Fuera de servicio" en el catÃ¡logo</span>
          </div>
          <label class="switch">
            <input type="checkbox" id="vp-hide-profile">
            <span class="slider"></span>
          </label>
        </div>

        <div class="config-row">
          <div class="config-info">
            <span class="config-label">ğŸ•’ Horario disponible</span>
            <span class="config-hint">Se mostrarÃ¡ en tu tarjeta del catÃ¡logo</span>
          </div>
          <div class="schedule-inputs">
            <div class="schedule-row">
              <label for="vp-hora-inicio" style="font-size:0.8rem;font-weight:600">De:</label>
              <input type="time" id="vp-hora-inicio" class="config-time">
            </div>
            <div class="schedule-row">
              <label for="vp-hora-fin" style="font-size:0.8rem;font-weight:600">A:</label>
              <input type="time" id="vp-hora-fin" class="config-time">
            </div>
          </div>
        </div>

        <div class="config-row">
          <div class="config-info">
            <span class="config-label">ğŸ•’ Turno</span>
            <span class="config-hint">Se mostrarÃ¡ en tu tarjeta del catÃ¡logo</span>
          </div>
          <select id="vp-turno" class="config-select">
            <option value="">Sin turno</option>
            <option value="matutino">ğŸŒ… Matutino</option>
            <option value="vespertino">ğŸŒ‡ Vespertino</option>
            <option value="ambos">ğŸŒ„ Ambos</option>
          </select>
        </div>

        <button id="vp-save-config" class="btn btn-primary btn-sm" style="margin-top:0.75rem">ğŸ’¾ Guardar configuraciÃ³n</button>
      </div>
    </div>

    <!-- QR del perfil -->
    <div class="container">
      <div id="vendor-qr-section" class="profile-qr-section" style="background:rgba(255,255,255,0.04);border-radius:var(--radius);padding:1.25rem;border:1px solid rgba(255,255,255,0.08);margin-bottom:1.5rem;">
        <p class="qr-label" style="font-size:0.95rem;font-weight:700;margin-bottom:0.5rem;">ğŸ“± CÃ³digo QR de tu perfil</p>
        <p style="font-size:0.78rem;color:rgba(255,255,255,0.55);margin-bottom:0.75rem;">ImprÃ­melo y ponlo en tu mesa o local para que te encuentren rÃ¡pido</p>
        <div id="profile-qr" class="qr-canvas"></div>
        <button id="download-qr" class="btn btn-outline btn-sm qr-download-btn" style="margin-top:0.75rem;">ğŸ“¥ Descargar QR</button>
      </div>
    </div>

    <!-- Pago por transferencia -->
    <div class="container">
      <div class="transfer-config-section">
        <h3>ğŸ¦ Pago por transferencia</h3>
        <p class="transfer-config-desc">Habilita esta opciÃ³n para que tus clientes puedan pagarte por transferencia bancaria.</p>
        <div class="toggle-row">
          <label class="switch">
            <input type="checkbox" id="vp-transfer-toggle">
            <span class="slider"></span>
          </label>
          <span id="vp-transfer-status">Deshabilitado</span>
        </div>
        <div id="vp-transfer-fields" class="transfer-fields" style="display:none">
          <div class="form-group">
            <label for="vp-bank-name">ğŸ¦ Banco *</label>
            <input type="text" id="vp-bank-name" placeholder="Ej: BBVA, Banamex, Banorte">
          </div>
          <div class="form-group">
            <label for="vp-bank-account">ğŸ’³ NÃºmero de cuenta / CLABE *</label>
          <input type="text" id="vp-bank-account" placeholder="Ej: 012345678901234567">
        </div>
        <div class="form-group">
          <label for="vp-bank-holder">ğŸ‘¤ Nombre del titular *</label>
          <input type="text" id="vp-bank-holder" placeholder="Nombre completo del titular">
        </div>
        <button id="vp-save-transfer" class="btn btn-primary btn-sm">ğŸ’¾ Guardar datos bancarios</button>
      </div>
    </div>
  </div>

  </div><!-- /tab-config -->

  <!-- ===== MODAL EDITAR PRODUCTO (overlay, fuera de tabs) ===== -->
  <div id="edit-product-modal" class="modal-overlay" style="display:none">
    <div class="modal-box" style="max-width:480px;width:92%;max-height:90vh;overflow-y:auto;">
      <h3 style="margin-bottom:1rem;">âœï¸ Editar Producto</h3>
      <form id="edit-product-form" autocomplete="off">
        <input type="hidden" id="edit-prod-id">
        <div class="form-group">
          <label for="edit-prod-nombre">Nombre *</label>
          <input type="text" id="edit-prod-nombre" required>
        </div>
        <div class="form-group">
          <label for="edit-prod-precio">Precio (MXN) *</label>
          <input type="number" id="edit-prod-precio" min="1" step="0.01" required>
        </div>
        <div class="form-group">
          <label for="edit-prod-categoria">CategorÃ­a *</label>
          <select id="edit-prod-categoria" required>
            <option value="">Selecciona...</option>
            <option value="ğŸ” Comida">ğŸ” Comida</option>
            <option value="ğŸ¥¤ Bebidas">ğŸ¥¤ Bebidas</option>
            <option value="ğŸ° Postres">ğŸ° Postres</option>
            <option value="ğŸ¬ Snacks">ğŸ¬ Snacks</option>
            <option value="ğŸ“š Materiales">ğŸ“š Materiales</option>
            <option value="ğŸ‘• Ropa">ğŸ‘• Ropa</option>
            <option value="ğŸ’» TecnologÃ­a">ğŸ’» TecnologÃ­a</option>
            <option value="âœï¸ Servicios">âœï¸ Servicios</option>
            <option value="ğŸ¨ Otros">ğŸ¨ Otros</option>
          </select>
        </div>
        <div class="form-group">
          <label for="edit-prod-descripcion">DescripciÃ³n</label>
          <textarea id="edit-prod-descripcion" placeholder="Detalles del producto..."></textarea>
        </div>
        <div class="form-group">
          <label for="edit-prod-lugar">Lugar de entrega *</label>
          <input type="text" id="edit-prod-lugar" required>
        </div>
        <div class="form-group">
          <label>Cambiar imagen (opcional)</label>
          <div class="file-input-wrapper">
            <input type="file" id="edit-prod-image" accept="image/*">
            <div class="upload-text">
              <div class="upload-icon">ğŸ“·</div>
              <strong>Haz clic</strong> o arrastra una imagen
            </div>
          </div>
          <img id="edit-prod-preview" class="img-preview" alt="Vista previa" style="display:none;margin-top:0.5rem;">
        </div>
        <div style="display:flex;gap:0.5rem;">
          <button type="submit" class="btn btn-primary form-submit" style="flex:1;">ğŸ’¾ Guardar cambios</button>
          <button type="button" class="btn btn-danger" style="flex:0.5;" onclick="document.getElementById('edit-product-modal').style.display='none'">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ===== ğŸ’¬ CHATS FLOTANTES TIPO MESSENGER ===== -->
  <div id="vendor-chat-heads" class="chat-heads-container"></div>

  <!-- ===== CHAT POPUP VENDEDOR ===== -->
  <div id="vendor-chat-popup" class="chat-popup vendor-chat-popup" style="display:none;">
    <div class="chat-popup-header">
      <div class="chat-popup-avatar">ğŸ’¬</div>
      <span id="vendor-chat-popup-name" class="chat-popup-name">Chat</span>
      <div class="chat-popup-header-actions">
        <button id="vendor-chat-minimize" class="chat-popup-minimize">â–¬</button>
        <button id="vendor-chat-popup-close" class="chat-popup-close">âœ•</button>
      </div>
    </div>
    <div id="vendor-chat-messages" class="chat-popup-messages"></div>
    <div class="chat-popup-input">
      <input type="text" id="vendor-chat-input" placeholder="Escribe un mensaje..." autocomplete="off">
      <button id="vendor-chat-send" class="chat-popup-send">â¤</button>
    </div>
  </div>

  <!-- ===== BOTTOM NAV (Mobile) ===== -->
  <nav class="bottom-nav">
    <div class="bottom-nav-inner">
      <a href="index.html" class="bottom-nav-item">
        <span class="nav-icon">ğŸ </span>
        <span>Inicio</span>
      </a>
      <a href="vender.html" class="bottom-nav-item">
        <span class="nav-icon">ğŸ·ï¸</span>
        <span>Vender</span>
      </a>
      <a href="perfilvendedor.html" class="bottom-nav-item active">
        <span class="nav-icon">ğŸ‘¤</span>
        <span>Vendedores</span>
      </a>
      <a href="ubbjotito.html" class="bottom-nav-item">
        <span class="nav-icon">ğŸ¾</span>
        <span>Ubbjotito</span>
      </a>
    </div>
  </nav>

  <!-- ===== FOOTER ===== -->
  <footer class="footer">
    UBBJ Tienda Universitaria &copy; 2026 â€” Sede MinatitlÃ¡n Â· Hecho con â¤ï¸ por alumnos
  </footer>

  <!-- ===== FIREBASE SDKs ===== -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-messaging-compat.js"></script>

  <!-- QR library -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- App -->
  <script src="app.js"></script>
</body>
</html>
